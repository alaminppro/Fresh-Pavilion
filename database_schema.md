
# Fresh Pavilion - Supabase Database SQL Setup

Copy and paste the following SQL into your Supabase SQL Editor and run it to set up all required tables.

```sql
-- 1. Create Products Table
CREATE TABLE IF NOT EXISTS products (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  name TEXT NOT NULL,
  price NUMERIC NOT NULL,
  description TEXT,
  image TEXT,
  category TEXT,
  stock INTEGER DEFAULT 0,
  unit TEXT,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT now()
);

-- 2. Create Orders Table
CREATE TABLE IF NOT EXISTS orders (
  id TEXT PRIMARY KEY, -- e.g. #FP-123456
  customer_name TEXT NOT NULL,
  customer_phone TEXT NOT NULL,
  location TEXT,
  items JSONB NOT NULL,
  total_price NUMERIC NOT NULL,
  status TEXT DEFAULT 'Pending',
  created_at TIMESTAMP WITH TIME ZONE DEFAULT now()
);

-- 3. Create Customers Table
CREATE TABLE IF NOT EXISTS customers (
  customer_phone TEXT PRIMARY KEY,
  customer_name TEXT NOT NULL,
  total_orders INTEGER DEFAULT 0,
  total_spent NUMERIC DEFAULT 0,
  last_location TEXT,
  updated_at TIMESTAMP WITH TIME ZONE DEFAULT now()
);

-- 4. Create Categories Table
CREATE TABLE IF NOT EXISTS categories (
  id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  name TEXT UNIQUE NOT NULL
);

-- 5. Create Admin Users Table
CREATE TABLE IF NOT EXISTS admin_users (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  username TEXT UNIQUE NOT NULL,
  password TEXT NOT NULL,
  phone TEXT,
  role TEXT DEFAULT 'staff'
);

-- 6. Create Site Settings Table
CREATE TABLE IF NOT EXISTS site_settings (
  key TEXT PRIMARY KEY,
  value TEXT
);

-- IMPORTANT: Disable RLS for ease of use during development
ALTER TABLE products DISABLE ROW LEVEL SECURITY;
ALTER TABLE orders DISABLE ROW LEVEL SECURITY;
ALTER TABLE customers DISABLE ROW LEVEL SECURITY;
ALTER TABLE categories DISABLE ROW LEVEL SECURITY;
ALTER TABLE admin_users DISABLE ROW LEVEL SECURITY;
ALTER TABLE site_settings DISABLE ROW LEVEL SECURITY;
```

## How to Get Notified of New Orders

### Method 1: Database Webhooks (Easiest)
1. In your Supabase Dashboard, go to **Database** -> **Webhooks**.
2. Enable Webhooks if not already enabled.
3. Create a new Webhook:
   - **Name:** New Order Alert
   - **Table:** `orders`
   - **Events:** `Insert`
   - **Type:** HTTP Request
   - **Method:** POST
   - **URL:** [Your Zapier, Make, or Discord Webhook URL]
4. Supabase will now send a JSON payload to that URL every time an order is placed.

### Method 2: Discord Notifications (Free)
1. Create a Discord Server and a Channel.
2. Channel Settings -> Integrations -> Webhooks -> New Webhook.
3. Copy the URL and paste it in the **Admin Panel -> Notifications** tab in the web app.
